---
import Layout from "../layouts/Layout.astro";
import { TattooFeed } from "../components/home/TattooFeed";
import { supabase } from "../lib/supabase";

// Fetch Flash Tattoos (Projects) for Explore
const { data: flashData } = await supabase
    .from("flash_tattoos")
    .select("*, profiles!inner(full_name, avatar_url, city, country)")
    .eq("is_available", true)
    .order("created_at", { ascending: false })
    .limit(50); // Fetch more for explore page

const projects = (flashData || []).map((flash: any) => ({
    id: flash.id,
    title: flash.title,
    description: flash.description || "",
    artist: {
        name: flash.profiles?.full_name || "Unknown Artist",
        avatar: flash.profiles?.avatar_url || "https://via.placeholder.com/150",
        location:
            [flash.profiles?.city, flash.profiles?.country]
                .filter(Boolean)
                .join(", ") || "Cuba",
    },
    media: [{ type: "image", url: flash.image_url }] as any[],
    tags: ["flash", "tattoo"],
}));
---

<Layout title="Explore Tattoos | InkLink">
    <main class="min-h-screen bg-zinc-50 dark:bg-zinc-950 pt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <header class="mb-12 text-center">
                <h1
                    class="text-4xl md:text-5xl font-black text-zinc-900 dark:text-white mb-4"
                >
                    Explore Designs
                </h1>
                <p
                    class="text-lg text-zinc-600 dark:text-zinc-400 max-w-2xl mx-auto"
                >
                    Discover thousands of unique tattoo designs from Cuba's top
                    artists. Filter by style, artist, or location.
                </p>
            </header>
            <TattooFeed client:load initialProjects={projects} />
        </div>
    </main>
</Layout>
