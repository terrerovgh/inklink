---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Create Account - InkLink">
    <main class="flex min-h-screen items-center justify-center p-4">
        <div
            class="w-full max-w-md space-y-8 rounded-2xl border border-border bg-card p-10 shadow-xl"
        >
            <div class="text-center">
                <h1
                    class="font-outfit text-4xl font-bold tracking-tight text-primary"
                >
                    InkLink
                </h1>
                <h2 class="mt-4 text-xl font-medium text-muted-foreground">
                    Create your account
                </h2>
            </div>

            <form class="space-y-6" id="register-form">
                <div>
                    <label
                        for="fullName"
                        class="block text-sm font-medium text-foreground"
                        >Full Name</label
                    >
                    <input
                        id="fullName"
                        name="fullName"
                        type="text"
                        autocomplete="name"
                        required
                        class="mt-2 block w-full rounded-md border border-input bg-background px-3 py-2 text-foreground shadow-sm focus:border-ring focus:outline-none focus:ring-1 focus:ring-ring sm:text-sm"
                    />
                </div>

                <div>
                    <label
                        for="email"
                        class="block text-sm font-medium text-foreground"
                        >Email address</label
                    >
                    <input
                        id="email"
                        name="email"
                        type="email"
                        autocomplete="email"
                        required
                        class="mt-2 block w-full rounded-md border border-input bg-background px-3 py-2 text-foreground shadow-sm focus:border-ring focus:outline-none focus:ring-1 focus:ring-ring sm:text-sm"
                    />
                </div>

                <div>
                    <label class="block text-sm font-medium text-foreground"
                        >I am a...</label
                    >
                    <div class="mt-2 grid grid-cols-3 gap-3">
                        <label class="cursor-pointer">
                            <input
                                type="radio"
                                name="role"
                                value="user"
                                class="peer sr-only"
                                checked
                            />
                            <div
                                class="rounded-md border border-input bg-background px-3 py-2 text-center text-sm font-medium hover:bg-muted peer-checked:border-primary peer-checked:text-primary peer-checked:ring-1 peer-checked:ring-primary"
                            >
                                Client
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input
                                type="radio"
                                name="role"
                                value="artist"
                                class="peer sr-only"
                            />
                            <div
                                class="rounded-md border border-input bg-background px-3 py-2 text-center text-sm font-medium hover:bg-muted peer-checked:border-primary peer-checked:text-primary peer-checked:ring-1 peer-checked:ring-primary"
                            >
                                Artist
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input
                                type="radio"
                                name="role"
                                value="studio_owner"
                                class="peer sr-only"
                            />
                            <div
                                class="rounded-md border border-input bg-background px-3 py-2 text-center text-sm font-medium hover:bg-muted peer-checked:border-primary peer-checked:text-primary peer-checked:ring-1 peer-checked:ring-primary"
                            >
                                Studio Owner
                            </div>
                        </label>
                    </div>
                </div>

                <div>
                    <label
                        for="password"
                        class="block text-sm font-medium text-foreground"
                        >Password</label
                    >
                    <input
                        id="password"
                        name="password"
                        type="password"
                        autocomplete="new-password"
                        required
                        class="mt-2 block w-full rounded-md border border-input bg-background px-3 py-2 text-foreground shadow-sm focus:border-ring focus:outline-none focus:ring-1 focus:ring-ring sm:text-sm"
                    />
                </div>

                <div>
                    <button
                        type="submit"
                        class="flex w-full justify-center rounded-md border border-transparent bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow-sm hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
                    >
                        Create Account
                    </button>
                </div>
            </form>

            <div class="relative">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-border"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="bg-card px-2 text-muted-foreground"
                        >Or continue with</span
                    >
                </div>
            </div>

            <div class="grid grid-cols-1 gap-3">
                <button
                    id="google-auth"
                    class="inline-flex w-full justify-center rounded-md border border-border bg-card px-4 py-2 text-sm font-medium text-foreground shadow-sm hover:bg-muted focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
                >
                    <span class="sr-only">Sign in with Google</span>
                    Google
                </button>
            </div>

            <p class="text-center text-sm text-muted-foreground">
                Already have an account?
                <a
                    href="/auth/signin"
                    class="font-medium text-primary hover:text-primary/80"
                    >Sign in</a
                >
            </p>
        </div>
    </main>
</Layout>

<script>
    import { supabase } from "../../lib/supabase";

    const form = document.getElementById("register-form") as HTMLFormElement;
    const googleBtn = document.getElementById("google-auth");

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const email = formData.get("email") as string;
        const password = formData.get("password") as string;
        const fullName = formData.get("fullName") as string;
        const role = formData.get("role") as string;

        const { data, error } = await supabase.auth.signUp({
            email,
            password,
            options: {
                data: {
                    full_name: fullName,
                    role: role,
                },
            },
        });

        if (error) {
            alert(error.message);
        } else {
            alert("Check your email for the confirmation link!");
            window.location.href = "/auth/signin";
        }
    });

    googleBtn?.addEventListener("click", async () => {
        await supabase.auth.signInWithOAuth({
            provider: "google",
            options: {
                redirectTo: window.location.origin + "/dashboard",
            },
        });
    });
</script>
