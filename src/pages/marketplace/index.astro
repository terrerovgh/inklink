---
import Layout from "../../layouts/Layout.astro";
import { MarketplaceSection } from "../../components/home/MarketplaceSection";
import { supabase } from "../../lib/supabase";

// Fetch Marketplace Items
const { data: marketData } = await supabase
    .from("products")
    .select("*")
    .eq("category", "gear") // Reusing gear category or similar
    .limit(20);

// Fallback logic inside map or pre-process
const items =
    marketData && marketData.length > 0
        ? marketData.map((item: any) => ({
              id: item.id,
              title: item.name,
              price: item.price,
              currency: item.currency || "USD",
              image: item.image_url,
              location: "Havana", // Default
              seller: "InkLink Market", // Default
          }))
        : []; // MarketplaceSection handles empty if we want, or we can pass some mocks if we prefer consistent look
---

<Layout title="Marketplace - InkLink">
    <main class="min-h-screen bg-zinc-50 dark:bg-zinc-900 pt-20">
        <div class="py-12">
            <div
                class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-12 text-center"
            >
                <h1
                    class="text-4xl md:text-5xl font-black text-zinc-900 dark:text-white mb-4"
                >
                    Marketplace
                </h1>
                <p
                    class="text-lg text-zinc-600 dark:text-zinc-400 max-w-2xl mx-auto"
                >
                    Buy and sell professional tattoo equipment, supplies, and
                    art.
                </p>
            </div>
            <MarketplaceSection items={items} />
        </div>
    </main>
</Layout>
