---
import DashboardLayout from "../../../layouts/DashboardLayout.astro";
import StudioTable from "../../../components/admin/StudioTable";
import { supabase } from "../../../lib/supabase";

// Security Check
const { user } = Astro.locals;
if (!user) return Astro.redirect("/auth/login");
const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .single();
if ((profile as any)?.role?.toLowerCase() !== "admin")
    return Astro.redirect("/dashboard");

// Fetch Studios
const { data: studios } = await supabase
    .from("studios")
    .select("*")
    .order("created_at", { ascending: false });
---

<DashboardLayout title="Studio Management">
    <div class="space-y-6">
        <div>
            <h1 class="text-3xl font-bold tracking-tight">Studios</h1>
            <p class="text-muted-foreground">
                Manage studios and verification status.
            </p>
        </div>

        <StudioTable client:load initialStudios={(studios as any) || []} />
    </div>
</DashboardLayout>
